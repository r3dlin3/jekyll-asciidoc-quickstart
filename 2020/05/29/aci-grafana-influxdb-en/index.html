<!DOCTYPE html>
<html class="no-js">
  <head>
	<meta charset="utf-8">
	<title>Grafana and InfluxDB on Azure Container Instances | A bit of everything</title>
	<meta name="description" content="Azure Container Instances allow to run containers. Here he is a small example with a group of containers of Grafana and InfluxDB.">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- CSS -->
	<link rel="stylesheet" href="/assets/css/main.css">

	<!--Favicon-->
	<link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

	<!-- Canonical -->
	<link rel="canonical" href="/2020/05/29/aci-grafana-influxdb-en/">

	<!-- RSS -->
	<link type="application/atom+xml" rel="alternate" href="https://r3dlin3.github.io/feed.xml" title="A bit of everything" />
	<!-- SEO -->
	<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Grafana and InfluxDB on Azure Container Instances | A bit of everything</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Grafana and InfluxDB on Azure Container Instances" />
<meta name="author" content="r3dLiN3" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Azure Container Instances allow to run containers. Here he is a small example with a group of containers of Grafana and InfluxDB." />
<meta property="og:description" content="Azure Container Instances allow to run containers. Here he is a small example with a group of containers of Grafana and InfluxDB." />
<link rel="canonical" href="https://r3dlin3.github.io/2020/05/29/aci-grafana-influxdb-en/" />
<meta property="og:url" content="https://r3dlin3.github.io/2020/05/29/aci-grafana-influxdb-en/" />
<meta property="og:site_name" content="A bit of everything" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-29T00:00:00+00:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"r3dLiN3"},"headline":"Grafana and InfluxDB on Azure Container Instances","dateModified":"2020-05-29T00:00:00+00:00","datePublished":"2020-05-29T00:00:00+00:00","description":"Azure Container Instances allow to run containers. Here he is a small example with a group of containers of Grafana and InfluxDB.","mainEntityOfPage":{"@type":"WebPage","@id":"https://r3dlin3.github.io/2020/05/29/aci-grafana-influxdb-en/"},"@type":"BlogPosting","url":"https://r3dlin3.github.io/2020/05/29/aci-grafana-influxdb-en/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">
	

	<!-- KaTeX -->
	

	<!-- Google Analytics -->
	
</head>

  <body>
    <header class="site-header">
	<div class="branding">
		
		<a href="/">
			<img class="avatar" src="/assets/img/avatar.png" alt="avatar"/>
		</a>
		
		<h1 class="site-title">
			<a href="/">A bit of everything</a>
		</h1>
	</div>
	<nav class="site-nav">
		<ul>
			
			
			
			
			<li>
				<a class="page-link" href="/about/">
					A propos
				</a>
			</li>
			
			
			
			
			
			
			
			
			
			
			
			<li>
				<a class="page-link" href="/tags/">
					tags
				</a>
			</li>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<!-- Social icons from Font Awesome, if enabled  -->
			
			
            
            <!-- Search bar -->
            
		</ul>
	</nav>
    
</header>

    <div class="content">
      <article >
  <header style="background-image: url('/')">
    <h1 class="title">Grafana and InfluxDB on Azure Container Instances</h1>
    
    <p class="meta">
      



29

mai
  
2020
      
    </p>
  </header>
  <section class="post-content"><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>This the translation of a <a href="/2020/02/01/aci-grafana-influxdb/">previous article</a>
published in French.</em></p>
</div>
<div class="paragraph">
<p>Azure Container Instances (ACI) is one of many ways to run containers on Azure. One of the advantages of ACI over App Service (presented in a <a href="/2020/01/01/sonarqube-app-service/">previous article (in French)</a>) is the ability to expose multiple ports.</p>
</div>
<div class="paragraph">
<p>So we&#8217;re going to expose a <a href="https://grafana.com/">Grafana</a> instance and an <a href="https://www.influxdata.com/products/influxdb-overview/">InfluxDB</a> database.
<a href="https://grafana.com/">Grafana</a> is an open source solution for creating dashboard. <a href="https://www.influxdata.com/products/influxdb-overview/">InfluxDB</a> is its companion of choice for time series storage.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this article, for simplicity sake, I will not expose Grafana over HTTPS.
You will have to refer to my previous article <a href="/2020/01/30/aci-letsencrypt-nginx/">Certificat Let&#8217;s Encrypt sur Azure Container Instances et NGINX (in French)</a> for the implementation of HTTPS.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the_solution"><a class="anchor" href="#the_solution"></a><a class="link" href="#the_solution">The solution</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>As mentioned, the solution will run on Azure Container Instances.</p>
</div>
<div class="paragraph">
<p>Grafana needs a database for its configuration. Grafana supports <a href="https://grafana.com/docs/grafana/latest/installation/requirements/#supported-databases"> 3 kind of databases</a>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sqlite</p>
</li>
<li>
<p>Mysql</p>
</li>
<li>
<p>Postgresql</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To avoid losing the configuration if the container restarts, the data is persistently stored on Azure Files.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Unfortunately, due to some <a href="https://docs.microsoft.com/fr-fr/rest/api/storageservices/features-not-supported-by-the-azure-file-service">limitations</a>, it was not possible to persist on Azure Files the SQLite database (embarked by default in Grafana) (a dark story about locks) or to use the Docker image provided by PostgreSQL (a dark  story about files and their owner).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will therefore use MySQL and its <a href="https://hub.docker.com/_/mysql">Docker image</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
MySQL will not be published on the Internet.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="grafana_data_sources"><a class="anchor" href="#grafana_data_sources"></a><a class="link" href="#grafana_data_sources">Grafana data sources</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is  <a href="https://grafana.com/docs/grafana/v6.5/administration/provisioning/#datasources">possible to provide a list of data sources</a> per YAML file.</p>
</div>
<div class="paragraph">
<p>We will use this mechanism to automatically set up InfluxDB as a data source.</p>
</div>
<div class="paragraph">
<p>So, the configuration of the data source in YAML will be:</p>
</div>
<div class="listingblock">
<div class="title">influxdb.yaml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="m">1</span>

<span class="na">deleteDatasources</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">InfluxDB</span>
    <span class="na">orgId</span><span class="pi">:</span> <span class="m">1</span>

<span class="na">datasources</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">InfluxDB</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">influxdb</span>
    <span class="na">access</span><span class="pi">:</span> <span class="s">proxy</span>
    <span class="na">orgId</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">database</span><span class="pi">:</span> <span class="s">PERF</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s">influxadmin</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">influxadmin</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">http://localhost:8086</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This file will be passed as a secret. The <code>base64</code> function of ARM template will be used to encode the content and pass it as a secret.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="note_about_container_groups_in_azure_container_instances"><a class="anchor" href="#note_about_container_groups_in_azure_container_instances"></a><a class="link" href="#note_about_container_groups_in_azure_container_instances">Note about container groups in Azure Container Instances</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Azure Container Instances use a "proprietary" format that is neither Docker Compose nor a Kubernetes deployment file.</p>
</div>
<div class="paragraph">
<p>The important point to keep in mind is that we will declare each port expose by a container, and then which of them are exposed by the container group. It is not possible to translate ports, as recall in the <a href="https://docs.microsoft.com/en-us/azure/container-instances/container-instances-troubleshooting#container-group-ip-address-may-not-be-accessible-due-to-mismatched-ports">FAQ</a>.</p>
</div>
<div class="paragraph">
<p>Also, beware that communication between containers is not using the name of the container (as in Docker Compose) but <strong>localhost</strong>!</p>
</div>
<div class="paragraph">
<p>Thus, Grafana will point in its configuration to <code>localhost:3036</code> for its database and <code>localhost:8086</code> for the case of InfluxDB.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="automated_deploiement"><a class="anchor" href="#automated_deploiement"></a><a class="link" href="#automated_deploiement">Automated deploiement</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to use YAML or ARM template. As mentioned in my <a href="/2020/01/30/aci-letsencrypt-nginx/#conclusion">previous article (in French)</a>,I highly recommend the use of ARM template that will allow to have some dynamic settings that can be changed during deployment.</p>
</div>
<div class="paragraph">
<p>However, I will limit the number of parameters.</p>
</div>
<div class="sect2">
<h3 id="environment_variables"><a class="anchor" href="#environment_variables"></a><a class="link" href="#environment_variables">Environment variables</a></h3>
<div class="paragraph">
<p>The environment variables we will use are described below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. MySQL</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MYSQL_DATABASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of a database to be created on image startup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MYSQL_USER, MYSQL_PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username and password of a user created that has superuser permissions on the database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MYSQL_RANDOM_ROOT_PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will generate a random password for the root user</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Other environment variables are available and are described on MySQL&#8217;s Docker image <a href="https://hub.docker.com/_/mysql">page</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. InfluxDB</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFLUXDB_DB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of a database to be created on image startup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFLUXDB_ADMIN_USER, INFLUXDB_ADMIN_PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username and password of database admin.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Other environment variables are available and are described on InfluxDB&#8217;s Docker image <a href="https://hub.docker.com/_/influxdb">page</a>.</p>
</div>
<div class="paragraph">
<p>Grafana has a very extensible mechanism that allows to define any <a href="https://grafana.com/docs/grafana/latest/installation/configuration/#using-environment-variables">parameter from environment variables</a>.
We will use the following environment variable.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Grafana</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GF_DATABASE_URL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection URL to MySQL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GF_SECURITY_ADMIN_PASSWORD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for admin (this will avoid going through the configuration assistant)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In my <a href="/2020/01/30/aci-letsencrypt-nginx/">previous article</a>, I also used the variable <code>GF_SERVER_DOMAIN</code> to set up Grafana behind NGINX.</p>
</div>
</div>
<div class="sect2">
<h3 id="arm_template"><a class="anchor" href="#arm_template"></a><a class="link" href="#arm_template">ARM template</a></h3>
<div class="paragraph">
<p>The ARM template and settings are shown below.</p>
</div>
<div class="listingblock">
<div class="title">grafana.json</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nl">"$schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"contentVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"grafanaAdminPassword"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"securestring"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password for Grafana admin."</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"containerGroupName"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Container Group name."</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"dnsLabel"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DNS label used to by the container group. The FQDN is &lt;dnsLabel&gt;.&lt;region&gt;.azurecontainer.io"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"storageAccountName"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Name of the Storage Account"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"storageAccountType"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Standard_LRS"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"allowedValues"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"Standard_LRS"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"Standard_GRS"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"Standard_ZRS"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"Premium_LRS"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Storage Account type"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"accessTier"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hot"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"allowedValues"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"Hot"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"Cool"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The access tier used for billing."</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"storageAccountKind"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"StorageV2"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"allowedValues"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"StorageV2"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"Storage"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"BlobStorage"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"FileStorage"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"BlockBlobStorage"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Storage Account type"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"advancedThreatProtectionEnabled"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bool"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enable or disable Advanced Threat Protection."</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"shares"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"List of the file share names."</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"location"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[resourceGroup().location]"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The region to deploy the resources into"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"tagValues"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"defaultValue"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"variables"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"dnsLabel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[if(empty(parameters('dnsLabel')), parameters('containerGroupName'), parameters('dnsLabel'))]"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"fqdn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[toLower(concat(variables('dnsLabel'),'.',replace(parameters('location'), ' ', ''),'.azurecontainer.io'))]"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"resources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.Storage/storageAccounts"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('storageAccountName')]"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('location')]"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"apiVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-07-01"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"sku"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('storageAccountType')]"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('storageAccountKind')]"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"accessTier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('accessTier')]"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"encryption"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"keySource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.Storage"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"services"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"blob"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nl">"enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="nl">"file"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nl">"enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nl">"supportsHttpsTrafficOnly"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"resources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"condition"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('advancedThreatProtectionEnabled')]"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"providers/advancedThreatProtectionSettings"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.Security/current"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"apiVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-08-01-preview"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"dependsOn"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="s2">"[resourceId('Microsoft.Storage/storageAccounts/', parameters('storageAccountName'))]"</span><span class="w">
                    </span><span class="p">],</span><span class="w">
                    </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"isEnabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.Storage/storageAccounts/fileServices/shares"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"apiVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-04-01"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[concat(parameters('storageAccountName'), '/default/', parameters('shares')[copyIndex()])]"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"copy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sharecopy"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"count"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[length(parameters('shares'))]"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"dependsOn"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"[parameters('storageAccountName')]"</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('containerGroupName')]"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.ContainerInstance/containerGroups"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"dependsOn"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"sharecopy"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"apiVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-10-01"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('location')]"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"containers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mysql"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nl">"image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mysql"</span><span class="p">,</span><span class="w">
                            </span><span class="nl">"environmentVariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MYSQL_USER"</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grafana"</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MYSQL_PASSWORD"</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"secureValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grafana"</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MYSQL_RANDOM_ROOT_PASSWORD"</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yes"</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MYSQL_DATABASE"</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grafana"</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">],</span><span class="w">
                            </span><span class="nl">"resources"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                </span><span class="nl">"requests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"cpu"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"memoryInGb"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">},</span><span class="w">
                            </span><span class="nl">"ports"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">3306</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">443</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">],</span><span class="w">
                            </span><span class="nl">"volumeMounts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mysql-data"</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"mountPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/lib/mysql"</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">]</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                                        </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"influxdb"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nl">"image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"influxdb"</span><span class="p">,</span><span class="w">
                            </span><span class="nl">"environmentVariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INFLUXDB_DB"</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PERF"</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INFLUXDB_ADMIN_USER"</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"influxadmin"</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INFLUXDB_ADMIN_PASSWORD"</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"secureValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"influxadmin"</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">],</span><span class="w">
                            </span><span class="nl">"resources"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                </span><span class="nl">"requests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"cpu"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"memoryInGb"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">},</span><span class="w">
                            </span><span class="nl">"ports"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">8086</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">],</span><span class="w">
                            </span><span class="nl">"volumeMounts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"influxdb-volume"</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"mountPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/lib/influxdb"</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">]</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grafana"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nl">"image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grafana/grafana"</span><span class="p">,</span><span class="w">

                            </span><span class="nl">"ports"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">3000</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">],</span><span class="w">
                            </span><span class="nl">"environmentVariables"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GF_SECURITY_ADMIN_PASSWORD"</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"secureValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('grafanaAdminPassword')]"</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GF_DATABASE_URL"</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"secureValue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mysql://grafana:grafana@localhost:3306/grafana"</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">],</span><span class="w">
                            </span><span class="nl">"resources"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                </span><span class="nl">"requests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"cpu"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"memoryInGb"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">},</span><span class="w">
                            </span><span class="nl">"volumeMounts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grafana-volume"</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"mountPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/lib/grafana"</span><span class="w">
                                </span><span class="p">},</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grafana-provisioning"</span><span class="p">,</span><span class="w">
                                    </span><span class="nl">"mountPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/etc/grafana/provisioning/datasources"</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">]</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="nl">"osType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Linux"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"restartPolicy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OnFailure"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"ipAddress"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Public"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"ports"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">3000</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="p">{</span><span class="w">
                            </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">8086</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">],</span><span class="w">
                    </span><span class="nl">"dnsNameLabel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[variables('dnsLabel')]"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nl">"volumes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mysql-data"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"azureFile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nl">"shareName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mysql-data"</span><span class="p">,</span><span class="w">
                            </span><span class="nl">"storageAccountName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('storageAccountName')]"</span><span class="p">,</span><span class="w">
                            </span><span class="nl">"storageAccountKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[listKeys(resourceId('Microsoft.Storage/storageAccounts',parameters('storageAccountName')),'2017-10-01').keys[0].value]"</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"influxdb-volume"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"azureFile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nl">"shareName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"influxdb-volume"</span><span class="p">,</span><span class="w">
                            </span><span class="nl">"storageAccountName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('storageAccountName')]"</span><span class="p">,</span><span class="w">
                            </span><span class="nl">"storageAccountKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[listKeys(resourceId('Microsoft.Storage/storageAccounts',parameters('storageAccountName')),'2017-10-01').keys[0].value]"</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grafana-volume"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"azureFile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nl">"shareName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grafana-volume"</span><span class="p">,</span><span class="w">
                            </span><span class="nl">"storageAccountName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('storageAccountName')]"</span><span class="p">,</span><span class="w">
                            </span><span class="nl">"storageAccountKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[listKeys(resourceId('Microsoft.Storage/storageAccounts',parameters('storageAccountName')),'2017-10-01').keys[0].value]"</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grafana-provisioning"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"secret"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nl">"influxdb.yaml"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[base64('apiVersion: 1

deleteDatasources:
  - name: InfluxDB
    orgId: 1

datasources:
  - name: InfluxDB
    type: influxdb
    access: proxy
    orgId: 1
    database: PERF
    user: influxadmin
    password: influxadmin
    url: http://localhost:8086
                            ')]"</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">

    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"outputs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grafana.parameters.json</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nl">"$schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"contentVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"grafanaAdminPassword"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"grafanapwd"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"containerGroupName"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test-grafana-influxdb"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"storageAccountName"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stotestacmenginx"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"shares"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"mysql-data"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"influxdb-volume"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"grafana-volume"</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"location"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"West Europe"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to deploy by using the following PowerShell command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="PowerShell"> New-AzResourceGroupDeployment -ResourceGroupName $rg -TemplateFile .\influxdb-grafana.json -TemplateParameterFile .\influxdb-grafana.parameters.json -Verbose</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, by using Az CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">az group deployment create <span class="nt">--resource-group</span> <span class="nv">$rg</span> <span class="nt">--template-file</span> ./influxdb-grafana.json <span class="nt">--parameters</span> @influxdb-grafana.parameters.json <span class="nt">--handle-extended-json-format</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You will have to use the setting <code>--handle-extended-json-format</code> that provides support for multiline in JSON.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a><a class="link" href="#conclusion">Conclusion</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Within a few minutes, it is possible to assemble a Grafana and an InfluxDB database.</p>
</div>
<div class="paragraph">
<p>There is a lot of use cases that might benefits for an InfluxDB and Grafana: IoT, application monitoring, etc. A use case could also be load tests with <a href="https://pypi.org/project/locust-influx/">Locust</a>. To be continued&#8230;&#8203;</p>
</div>
</div>
</div></section>
  
<footer>
  <div class="tags">
    
    <a class="tag" href="/tags#docker">#docker</a>
    
    <a class="tag" href="/tags#aci">#aci</a>
    
    <a class="tag" href="/tags#azure">#azure</a>
    
    <a class="tag" href="/tags#influxdb">#influxdb</a>
    
    <a class="tag" href="/tags#grafana">#grafana</a>
    
    <a class="tag" href="/tags#english">#english</a>
    
    <a class="tag" href="/tags#arm">#arm</a>
    
  </div>
</footer>


</article>

<!-- Disqus -->


<!-- Post navigation -->

  <div id="post-nav">
  
  <div id="previous-post" class="post-nav-post">
      <p>Article prcdent</p>
      <a href="/2020/05/19/moteur-template-php-i18n/">
        Moteur de template PHP et internationalisation
      </a>
  </div>
  
  
  <div id="next-post" class="post-nav-post">
      <p>Article suivant</p>
      <a href="/2020/06/10/filtrer-sql-app-service/">
        Configurer automatiquement le firewall SQL/MySQL/PostgreSQL pour un App Service
      </a>
  </div>
  
</div>



    </div>
    


<footer class="site-footer">
	<nav class="site-nav">
		<ul>
			
<li>
	<a href="/feed.xml" title="Suivre sur RSS">
		<i class="fa fa-fw fa-rss"></i>
	</a>
</li>















<li>
	<a href="https://github.com/r3dlin3" title="Follow on GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>




























		</ul>
	</nav>
	<p class="text">Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <i class="fa fa-heart" aria-hidden="true" style="color:Tomato"></i>
</p>
</footer>

  </body>
</html>
